<!doctype html>
<html lang="en">
    <head>

        <title>[s03] NG Exile</title>
        
        <link rel="shortcut icon" href="/static/favicon.ico">
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <link href="{{PATH_IMAGES}}styles/s_default/style.css" type="text/css" rel="stylesheet" media="all"/>
        
        <script type="text/javascript" src="/static/scripts/common.js"></script>
        
    </head>

    <body>

        <script>
            function alertAbandon() { window.alert('Attention ! En validant vous supprimerez définitivement votre compte.') }
            
            {% if galaxies %}
            let rec = []
            {% for galaxy in galaxies %}rec[{{galaxy.id}}] = {{galaxy.recommendation}}{% endfor %}
            
            function showRecommendation(obj) {
            
                let r = rec[obj.options[obj.selectedIndex].value]
                if (r == 2) {
                    $("recommendation").innerHTML = 'Galaxie recommandée'
                    $("recommendation").className = 'mt-1 text-center text-success'
                }
                else if (r == 1) {
                    $("recommendation").innerHTML = ''
                    $("recommendation").className = ''
                }
                else {
                    $("recommendation").innerHTML = 'Galaxie non recommandée'
                    $("recommendation").className = 'mt-1 text-center text-danger'
                }
            }
            {% endif %}
        </script>

        <div id="page">
            <div class="card">
                <div class="card-header">
                    <div class="row gx-2 align-items-center justify-content-center">
                        <div class="col-auto"><img src="/static/img/logo.png" width="32px" class="rounded" /></div>
                        <div class="col-auto"><span class="fs-6">Game Over</span></div>
                    </div>
                </div>
                <div class="card-body p-3">
                
                    <p class="text-center text-success fs-5">{{username}}</p>
                    
                    {% if gameover %}
                    <p class="text-center text-normal">
                        Malgré tous vos efforts pour développer votre Nation, vous n'avez pu faire face aux puissants ennemis qui vous ont mené à la destruction.
                    </p>
                    {% endif %}
                    
                    {% if bankrupt %}
                    <p class="text-center text-normal">
                        Malgré tous vos efforts pour développer votre Nation, vous n'avez su gérer correctement le budget de celui-ci ce qui a amené votre peuple à choisir un autre dirigeant.
                        Vous finissez votre vie dans une des prisons coloniales comme un vulgaire voleur.
                    </p>
                    {% endif %}
                    
                    {% if retry %}
                    <p class="text-center text-normal">
                        L'univers d'Exile est grand, et si vous le décidez, une chance supplémentaire vous sera donnée de montrer au monde votre courage et votre sagacité.
                        En choisissant de Rejouer, une nouvelle planète libre vous sera allouée. Vos Rapports et Messages seront conservés ainsi que certaines de vos Recherches. Vous aurez la possibilité de changer de nom à la page suivante.
                    </p>
                    
                    <form method="post" action="?">
                        {% csrf_token %}
                        <div class="text-center"><input type="radio" class="radio" name="action" id="continue" value="continue" checked><label for="continue">Rejouer</label></div>
                        <div class="text-center"><input type="radio" class="radio" name="action" id="abandon" value="abandon" onclick="alertAbandon()"><label for="abandon">Supprimer le compte</label></div>
                        <div class="mt-3 text-center"><input type="submit" value="Valider"></div>
                    </form>
                    {% endif %}
                    
                    {% if changename %}
                    <p class="text-center text-normal">
                        Si vous le souhaitez, vous pouvez changer de nom. Ceci peut vous aider à prendre un nouveau départ de manière anonyme.
                        L'ancien nom deviendra alors disponible aux nouveaux joueurs ou aux joueurs souhaitant modifier leur nom suite à un game over.
                    </p>
                    
                    <form method="post" action="?">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="retry">
                        
                        <div class="mb-3">
                            <div class="row gx-2 align-items-center justify-content-center">
                                <div class="col-auto">Nouveau nom</div>
                                <div class="col-auto"><input type="text" name="username" value="{{username}}" /></div>
                            </div>
                            {% if username_exists %}<div class="mt-1 text-center text-danger">Cet utilisateur existe déjà, choisissez un nouveau nom.</div>{% endif %}
                            {% if check_username %}<div class="mt-1 text-center text-danger">Le nom d'utilisateur doit être composé de 2 à 12 lettres, chiffres ou tiret, vérifiez votre entrée.</div>{% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <div class="row gx-2 align-items-center justify-content-center">
                                <div class="col-auto">Galaxie de départ</div>
                                <div class="col-auto">
                                    <select name="galaxy" id="galaxies" onchange="showRecommendation(this)">
                                        {% for galaxy in galaxies %}<option value="{{galaxy.id}}"{% if galaxy.selected %} selected{% endif %}>{{galaxy.id}}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div id="recommendation"></div>
                            {% if no_free_planet %}<div class="mt-1 text-center text-danger">Aucune planète n'est disponible dans la galaxie choisie.</div>{% endif %}
                        </div>
                        
                        <div class="text-center"><input type="submit" value="Valider"></div>
                        
                    </form>
                    {% endif %}
                    
                </div>
            </div>
        </div>
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-212X2QX8W5"></script>
        <script>
            window.dataLayer = window.dataLayer || []
            function gtag(){ dataLayer.push(arguments) }
            gtag('js', new Date())
            gtag('config', 'G-212X2QX8W5')
        </script>

        {% if galaxies %}<script>showRecommendation($("galaxies"))</script>{% endif %}
        
    </body>
</html>