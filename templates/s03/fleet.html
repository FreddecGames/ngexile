{% extends "s03/layout.html" %}
{% load humanize %}
{% block content %}
{% if context %}<div class="scroll-content" style="height:calc(100% - 106px);">{% endif %}
<div class="page-content">
    {% if fleet.action == 0 %}
        <script>
        function confirmAbandon() { return confirm('Êtes-vous sûr de vouloir abandonner la flotte "{{ fleet.name }}" ?\r\nLes vaisseaux seront endommagés de telle sorte qu\'ils ne pourront être réutilisés !'); }
        </script>
        <div id="renamebox" class="hidden">
            <form action="?id={{ fleet.id }}" method="post" class="row gx-2">
                {% csrf_token %}
                <input type='hidden' name='action' value='rename'>
                <div class="col">
                    <input type='text'
                           class="form-control"
                           name='newname'
                           value='{{ fleet.name }}'>
                </div>
                <div class="col-auto">
                    <input type="submit" class="btn btn-primary" value='OK'>
                </div>
                <div class="col-auto">
                    <button type="button" onclick="hide();" class="btn btn-danger">
                        <i class="fa-fw fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
            </form>
        </div>
    {% endif %}
    <div class="row gx-3">
        <div class="col-8">
            <div class="card">
                <div id="renameref" class="card-header">
                    <div class="row gx-3 align-items-baseline">
                        <div class="col">
                            <span class="fs-6">{{ fleet.name }}</span>
                        </div>
                        {% if fleet.action == 0 and not fleet.engaged %}
                            <div class="col-auto">
                                <a href="#" onclick="return show('renameref','renamebox')">Renommer</a>
                            </div>
                            <div class="col-auto">
                                <a href="?planet={{ fleet.planetid }}&id={{ fleet.id }}&action=abandon"
                                   onclick="return confirmAbandon()">Abandonner</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                <div class="row g-2 flex-column">                
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Action</span>
                            </div>
                            <div class="col-9">
                                <div class="row gx-3 align-items-center">
                                    <div class="col">
                                        <div class="row gx-3 align-items-center">
                                            {% if fleet.engaged %}
                                                <div class="col-auto">
                                                    <span class="text-danger">En combat</span>
                                                </div>
                                                <div class="col">
                                                    <script>putplanet("{{fleet.planetid}}","{{fleet.planet_name}}","{{fleet.planet_galaxy}}","{{fleet.planet_sector}}","{{fleet.planet_planet}}",{{fleet.planet_owner_relation}});</script>
                                                </div>
                                            {% elif fleet.action == -1 or fleet.action == 1 %}
                                                <div class="col-auto">
                                                    <span class="text-success">En transit</span>
                                                </div>
                                                <div class="col">
                                                    <script>putplanet("{{fleet.planetid}}","{{fleet.planet_name}}","{{fleet.planet_galaxy}}","{{fleet.planet_sector}}","{{fleet.planet_planet}}",{{fleet.planet_owner_relation}});</script>
                                                    <small class="mx-1 text-normal"><i class="fa-fw fas fa-long-arrow-alt-right"></i></small>
                                                    <script>putplanet("{{fleet.destplanetid}}","{{fleet.destplanet_name}}","{{fleet.destplanet_galaxy}}","{{fleet.destplanet_sector}}","{{fleet.destplanet_planet}}",{{fleet.destplanet_owner_relation}});</script>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="text-yellow"><script>putcountdown1({{fleet.remaining_time}}, 'Arrivé', '?id={{fleet.id}}')</script></span>
                                                </div>
                                            {% elif fleet.action == 2 %}
                                                <div class="col-auto">
                                                    <span class="text-success">En recyclage</span>
                                                </div>
                                                <div class="col">
                                                    <script>putplanet("{{fleet.planetid}}","{{fleet.planet_name}}","{{fleet.planet_galaxy}}","{{fleet.planet_sector}}","{{fleet.planet_planet}}",{{fleet.planet_owner_relation}});</script>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="text-yellow"><script>putcountdown1({{fleet.remaining_time}}, 'Cycle terminé', '?id={{fleet.id}}')</script></span>
                                                </div>
                                            {% elif fleet.action == 4 %}
                                                <div class="col-auto">
                                                    <span class="text-normal">En attente</span>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="text-yellow"><script>putcountdown1({{fleet.remaining_time}}, 'Terminé', '?id={{fleet.id}}')</script></span>
                                                </div>
                                            {% elif fleet.action == 0 %}
                                                <div class="col-auto">
                                                    <span class="text-normal">En patrouille</span>
                                                </div>
                                                <div class="col">
                                                    <script>putplanet("{{fleet.planetid}}","{{fleet.planet_name}}","{{fleet.planet_galaxy}}","{{fleet.planet_sector}}","{{fleet.planet_planet}}",{{fleet.planet_owner_relation}});</script>
                                                </div>
                                            {% endif %}
                                        </div>
                                        {% if actions|length > 0 %}
                                            <ul class="mt-1 mb-0">
                                                {% for action in actions %}
                                                    <li>
                                                        {% if action.action == 1 %}
                                                            <span class="text-normal pe-3">Aller vers</span>
                                                            <script>putplanet("{{action.id}}","{{action.name}}","{{action.galaxy}}","{{action.sector}}","{{action.planet}}",{{action.relation}});</script>
                                                        {% elif action.action == 0 and action.ore > 0 %}<span class="text-normal">Tout charger</span>
                                                        {% elif action.action == 0 and action.ore < 0 %}<span class="text-normal">Tout décharger</span>
                                                        {% elif action.action == 2 %}<span class="text-normal">Récolter les ressources</span>
                                                        {% elif action.action == 5 %}<span class="text-normal">Envahir</span>
                                                        {% elif action.action == 4 %}<span class="text-normal">Attendre</span>
                                                        {% endif %}
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                    {% if fleet.can_warp and not fleet.engaged %}
                                        <div class="col-auto">
                                            <a href="?id={{ fleet.id }}&action=warp">Emprunter le vortex</a>
                                        </div>
                                    {% endif %}
                                    {% if fleet.action == 4 %}
                                        <div class="col-auto">
                                            <a href="?id={{ fleet.id }}&action=stopwaiting">Stopper</a>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Attitude</span>
                            </div>
                            <div class="col-9">
                                <div class="row gx-3 align-items-center">
                                    <div class="col">
                                        {% if fleet.attackonsight %}
                                            <img src="{{ PATH_IMAGES }}img/interface/stance_attack.gif"
                                                 class="me-1 stance"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-title="Mode attaque"
                                                 width="10px"
                                                 height="10px">
                                            <span>Mode attaque</span>
                                        {% else %}
                                            <img src="{{ PATH_IMAGES }}img/interface/stance_defend.gif"
                                                 class="me-1 stance"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-title="Mode riposte"
                                                 width="10px"
                                                 height="10px">
                                            <span>Mode riposte</span>
                                        {% endif %}
                                    </div>
                                    <div class="col-auto">
                                        {% if fleet.firepower > 0 and not fleet.engaged %}
                                            <a href="?id={{ fleet.id }}&action={% if fleet.attackonsight %}defend{% else %}attack{% endif %}">
                                                {% if fleet.attackonsight %}Riposter
                                                {% else %}Attaquer
                                                {% endif %}
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="commandersbox" class="hidden">
                        <form action='?id={{ fleet.id }}' method='post' class="row gx-2">
                            {% csrf_token %}
                            <input type='hidden' name='action' value='assigncommander'>
                            <div class="col-auto"><select class="form-control" name='commander'>
                                {% if planet.commanderid %}<option value='0'>Renvoyer</option>
                                {% else %}<option value='0'>Aucun</option>
                                {% endif %}
                                {% for optgroup in optgroups %}
                                    <optgroup label="{% if optgroup.typ == 'fleet' %}sur Flottes{% endif %}{% if optgroup.typ == 'planet' %}sur Planètes{% endif %}{% if optgroup.typ == 'none' %}Non affectés{% endif %}">
                                        {% for cmd in optgroup.cmds %}
                                            <option value={{ cmd.id }}{% if cmd.id == planet.commanderid %} selected{% endif %}>&middot;&nbsp;{{ cmd.name }}
                                                {% if cmd.fleetname %}({{ cmd.fleetname }}){% endif %}
                                                {% if cmd.planetname %}({{ cmd.planetname }}){% endif %}
                                                {% if cmd.unavailable %}(Indisponible){% endif %}
                                            </option>
                                        {% endfor %}
                                    </optgroup>
                                {% endfor %}
                            </select></div>
                            <div class="col-auto">
                                <input type="submit" class="btn btn-primary" value='OK'>
                            </div>
                            <div class="col-auto">
                                <button type="button" onclick="hide();" class="btn btn-danger">
                                    <i class="fa-fw fas fa-times" aria-hidden="true"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Commandement</span>
                            </div>
                            <div id="cmdref" class="col-9">
                                <div class="row gx-3 align-items-center">
                                    <div class="col-auto">
                                        {{ fleet.leadership|intcomma }} <small class="text-normal">/{{ fleet.size|intcomma }}</small>
                                        <small class="ms-3 text-normal">efficacité</small> {{ fleet.commander_efficiency }}%
                                    </div>
                                    <div class="col">
                                        {% if fleet.commanderid %}<i class="fa-fw fas fa-user-astronaut text-normal"></i> {{ fleet.commandername }}{% endif %}
                                    </div>
                                    {% if fleet.action == 0 and not fleet.engaged %}
                                    <div class="col-auto">
                                        <a href="#" onclick="return show('cmdref','commandersbox')">Changer</a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if fleet.recycler_output > 0 %}
                        <div class="col-12">
                            <div class="row gx-3 align-items-center">
                                <div class="col-3">
                                    <span class="text-normal">Recyclage</span>
                                </div>
                                <div class="col-9">
                                    <div class="row gx-3 align-items-center">
                                        <div class="col">
                                            {{ fleet.recycler_output|intcomma }} <span class="text-normal">unités /heure</span>
                                        </div>
                                        <div class="col-auto">
                                            {% if can_recycle and not fleet.engaged %}<a href="?id={{ fleet.id }}&action=recycle">Recycler</a>{% endif %}
                                            {% if fleet.action == 2 %}<a href="?id={{ fleet.id }}&action=stoprecycling">Stopper</a>{% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% if can_invade %}
                        <div id="invadebox" class="hidden">
                            <form action="?id={{ fleet.id }}"
                                  method="post"
                                  class="row gx-2 align-items-center">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="invade">
                                <div class="col-auto">
                                    <span class="text-normal">Envahir avec</span>
                                </div>
                                <div class="col-auto">
                                    <input id="droppods"
                                           min="1"
                                           type="number"
                                           name="droppods"
                                           size="6"
                                           maxlength="6"
                                           align="right"
                                           class="form-control"
                                           value="{{ fleet.droppods }}">
                                </div>
                                <div class="col-auto">
                                    <span class="text-normal">soldats</span>
                                </div>
                                {% if fleet.can_take_planet %}
                                    <div class="col-auto">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="take" name="take">
                                            <label class="form-check-label" for="take">
                                                Occuper planète
                                            </label>
                                        </div>
                                    </div>
                                    {% if fleet.prestige_cost > 0 %}
                                        <div class="col-auto">
                                            <img src="{{ PATH_IMAGES }}img/interface/prestige.gif"
                                                 title="Prestige"
                                                 class="res"
                                                 width="16px"
                                                 height="16px">
                                            {{ fleet.prestige_cost }}
                                        </div>
                                    {% endif %}
                                {% endif %}
                                <div class="col-auto">
                                    <input type="submit" class="btn btn-primary" value='OK'>
                                </div>
                                <div class="col-auto">
                                    <button type="button" onclick="hide();" class="btn btn-danger">
                                        <i class="fa-fw fas fa-times" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    {% endif %}
                    {% if fleet.droppods > 0 %}
                        <div class="col-12">
                            <div class="row gx-3 align-items-center">
                                <div class="col-3">
                                    <span class="text-normal">Barges d'invasion</span>
                                </div>
                                <div id="invaderef" class="col-9">
                                    <div class="row gx-3 align-items-center">
                                        <div class="col">
                                            {{ fleet.droppods|intcomma }} <span class="text-normal">soldats</span>
                                        </div>
                                        {% if can_invade %}
                                            <div class="col-auto">
                                                <script>putcountdown2({{invade_time}},"Invasion possible dans ", '<a href="#" onclick=\'return show("invaderef","invadebox")\'>Envahir</a>');putcountdown1({{invade_time}},"","#")</script>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Saut intergalactique</span>
                            </div>
                            <div class="col-9">
                                <span class="text-normal">signature max</span> <span class="{% if insufficient_long_distance_capacity %}text-danger{% endif %}">{{ fleet.long_distance_capacity|intcomma }}</span> <span class="ms-3 text-normal">stabilité requise</span> {{ fleet.required_vortex_strength|intcomma }}
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Signature</span>
                            </div>
                            <div class="col-9">
                                {{ fleet.real_signature|intcomma }} <span class="ms-3 text-normal">détectée</span> {{ fleet.signature|intcomma }}
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Entretien</span>
                            </div>
                            <div class="col-9">
                                <img src="{{ PATH_IMAGES }}img/interface/credits.gif"
                                     title="Credits"
                                     class="res"
                                     width="16px"
                                     height="16px">
                                {{ fleet.upkeep|intcomma }} <span class="ms-3 text-normal">x{{ fleet.upkeep_multiplicator }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Vitesse</span>
                            </div>
                            <div class="col-9">
                                <div class="row gx-3 align-items-center">
                                    <div class="col">
                                        {{ fleet.speed|intcomma }}
                                    </div>
                                    {% if can_cancel_moving %}
                                        <div class="col-auto">
                                            <span class="text-normal">Perte du contact</span> <span class="text-yellow"><script>putcountdown1({{timelimit}},"Effective"," ");</script></span> <script>putcountdown2({{timelimit}},'<a href="?id={{fleet.id}}&action=return">Annuler</a>', '');</script>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row gx-3 align-items-center">
                            <div class="col-3">
                                <span class="text-normal">Partage</span>
                            </div>
                            <div class="col-9">
                                <div class="row gx-3 align-items-center">
                                    <div class="col">
                                        <span class="text-normal">Flotte partagée à l'alliance</span>
                                        {% if not fleet.engaged %}<a href="?id={{ fleet.id }}&action=share">{% endif %}
                                            {% if shared %}Oui{% else %}Non{% endif %}
                                        {% if not fleet.engaged %}</a>{% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if fleet.cargo_capacity > 0 %}
                        <div class="col-12">
                            <div class="row gx-3 align-items-center">
                                <div class="col-3">
                                    <span class="text-normal">Cargaison</span>
                                </div>
                                <div class="col-9">
                                    <span id="load">{{ fleet.cargo_load|intcomma }}</span> <small class="text-normal">/{{ fleet.cargo_capacity|intcomma }} unités</small>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% for message in messages %}
                        <div class="col-12">
                            <div class="alert alert-{{ message.tags }} text-center">
                                {% if message.message == 'error_soldiers' %}Nombre de soldat incorrect !{% endif %}
                                {% if message.message == 'error_fleet' %}La flotte n'est pas prête pour une invasion !{% endif %}
                                {% if message.message == 'error_planet' %}Impossible d'envahir une planète inoccupée, alliée ou dans une alliance qui n'est pas en guerre contre nous !{% endif %}
                                {% if message.message == 'error_invade_enemy_ships' %}Impossible d'envahir tant que des vaisseaux militaires ennemis sont proches de la planète !{% endif %}
                                {% if message.message == 'error_name' %}mmm{% endif %}
                                {% if message.message == 'bad_destination' %}Destination non valide{% endif %}
                                {% if message.message == 'new_player_protection' %}Planète temporairement protégée{% endif %}
                                {% if message.message == 'long_travel_impossible' %}Saut impossible{% endif %}
                                {% if message.message == 'not_enough_credits' %}Pas assez de crédits{% endif %}
                                {% if message.message == 'error_jump_from_require_empty_location' %}Impossible de sauter d'ici. Déplacez la flotte à proximité d'un vortex avant de sauter.{% endif %}
                                {% if message.message == 'error_jump_protected_galaxy' %}Galaxie protégée{% endif %}
                                {% if message.message == 'error_jump_to_require_empty_location' %}Impossible de sauter vers cette destination. Choisissez un vortex comme point d'arrivé.{% endif %}
                                {% if message.message == 'error_jump_to_same_point_limit_reached' %}Trop de flottes sautent vers la même destination, utilisez des vortex avec stabilité suffisante.{% endif %}
                                {% if message.message == 'error_recycling' %}Une de nos flottes est déjà en train de recycler dans les parages !{% endif %}
                                {% if message.message == 'error_max_planets_reached' %}Nombre maximal de colonisations atteint !{% endif %}
                                {% if message.message == 'error_deploy_enemy_ships' %}Impossible de coloniser tant que des vaisseaux militaires ennemis sont proches de la planète !{% endif %}
                                {% if message.message == 'error_deploy_too_many_safe_planets' %}Impossible de coloniser plus de planètes dans des galaxies protégées !{% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            </div>
            {% if can_move %}
                <script>
                var tab = new Array();

                function fillDest(obj) {
                
                    var dest = obj.selectedIndex;
                    setval("g",tab[dest][0]);
                    setval("s",tab[dest][1]);
                    setval("p",tab[dest][2]);	
                }
                
                var index = 0
                function d(idx, name, g, s, p) { tab[index] = new Array(g, s, p); index++; }
                
                {% if planetgroup %}
                    {% for location in planetgroup %}d({{location.id}},'{{location.name}}',{{location.galaxy}},{{location.sector}},{{location.planet}});{% endfor %}
                {% endif %}

                {% if fleetgroup %}
                    {% for location in fleetgroup %}d({{location.planetid}},'{{location.name}}',{{location.planet_galaxy}},{{location.planet_sector}},{{location.planet_planet}});{% endfor %}
                {% endif %}

                {% if merchantplanetsgroup %}
                    {% for location in merchantplanetsgroup %}d({{location.id}},'',{{location.galaxy}},{{location.sector}},{{location.planet}});{% endfor %}
                {% endif %}

                function setTravelTime(seconds)
                {
                    var traveleta_obj = document.getElementById("travel_eta");
                    var traveltime_obj = document.getElementById("travel_time");

                    if(seconds < 0)
                    {
                        var s = "<span class='text-danger'>Saut impossible</span>";
                        if(traveltime_obj.innerHTML != s) traveltime_obj.innerHTML = s;

                        traveleta_obj.innerHTML = "";
                    }
                    else
                    {
                        var s = formattime(seconds);
                        if(traveltime_obj.innerHTML != s) traveltime_obj.innerHTML = s;
                    }
                }

                function updatetravel() {
                    window.setTimeout("updatetravel()", 100);
                    var to_g = getval("g");

                    if(to_g < 0){ to_g = 1; setval("g", 1); }

                    var to_s = getval("s");

                    if(to_s < 0){ to_s = 1; setval("s", 1); }
                    if(to_s > 99){ to_s = 99; setval("s", 99); }

                    var to_p = getval("p");

                    if(to_p < 0){ to_p = 1; setval("p", 1); }
                    if(to_p > 25){ to_p = 25; setval("p", 25); }


                    var oTravelCost = document.getElementById("travel_cost");

                    var cost = 0;
                    var distance = 0;
                    var time = 0;

                    if({{fleet.planet_galaxy}} != to_g) {
                        if({{fleet.real_signature}} > {{fleet.long_distance_capacity}}) {
                            var s = "-";
                            if(oTravelCost.innerHTML != s) oTravelCost.innerHTML = s;

                            setTravelTime(-1);

                            return;
                        }

                        distance = 200;
                        time = {{fleet.required_vortex_strength}}*24*3600;
                    }
                    else {
                        if({{fleet.planet_sector}} != to_s)
                            distance = 6*Math.sqrt( Math.pow(Math.floor((to_s-1) / 10) - Math.floor(({{fleet.planet_sector}}-1)/10), 2) + Math.pow((to_s-1) % 10 - ({{fleet.planet_sector}}-1)%10, 2) );
                        else
                        if({{fleet.planet_planet}} != to_p)
                            distance = Math.sqrt( Math.pow(Math.floor((to_p-1) / 5) - Math.floor(({{fleet.planet_planet}}-1)/5), 2) + Math.pow((to_p-1) % 5 - ({{fleet.planet_planet}}-1)%5, 2) );

                        time = Math.floor(distance * (1000.0/{{fleet.speed}}) * 3600);
                    }
                    
                    cost = Math.floor(distance / 200.0 * {{fleet.real_signature}});

                    setTravelTime(time);

                    if(distance > 0 && cost == 0) cost = 1;
                    if(oTravelCost.innerHTML != cost) oTravelCost.innerHTML = formatnumber(cost);
                }
                </script>
                <form method="post" action="?id={{ fleet.id }}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="move">
                    <input type="hidden" name="loop" value="0">
                    <div class="mt-3 card">
                        <div class="card-header">
                            <span class="fs-6">Déplacer la flotte</span>
                        </div>
                        <div class="card-body">
                            <div class="row g-1 flex-column">
                                <div class="col-12">
                                    <div class="row gx-3 align-items-center">
                                        <div class="col-3">
                                            <span class="text-normal">Action</span>
                                        </div>
                                        <div class="col">
                                            <select class="form-control" name="movetype">
                                                <option value="0">
                                                    Aller simple
                                                </option>
                                                <option value="1">
                                                    Aller décharger puis revenir
                                                </option>
                                                <option value="2">
                                                    Aller recycler puis revenir
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="row gx-3 align-items-center">
                                        <div class="col-3">
                                            <span class="text-normal">Destination</span>
                                        </div>
                                        <div class="col">
                                            <div class="row gx-1 align-items-center">
                                                <div class="col-auto">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="1"
                                                           name="g"
                                                           size="3"
                                                           maxlength="2"
                                                           value="{{fleet.planet_galaxy}}">
                                                </div>
                                                <div class="col-auto">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="1"
                                                           name="s"
                                                           size="3"
                                                           maxlength="2"
                                                           value="{{fleet.planet_sector}}">
                                                </div>
                                                <div class="col-auto">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="1"
                                                           name="p"
                                                           size="3"
                                                           maxlength="2"
                                                           value="{{fleet.planet_planet}}">
                                                </div>
                                                <div class="col">
                                                    <select class="form-control"
                                                            name="planetlist"
                                                            tabindex="1"
                                                            onchange="fillDest(this)">
                                                        {% if planetgroup %}
                                                            <optgroup label="Planètes">
                                                                {% for location in planetgroup %}
                                                                    <option {% if location.id == fleet.planetid %}selected{% endif %}>
                                                                        {{ location.name }} ({{ location.galaxy }}.{{ location.sector }}.{{ location.planet }})
                                                                    </option>
                                                                {% endfor %}
                                                            </optgroup>
                                                        {% endif %}
                                                        {% if fleetgroup %}
                                                            <optgroup label="Vers Flottes">
                                                                {% for location in fleetgroup %}
                                                                    <option {% if location.id == fleet.planetid %}selected{% endif %}>
                                                                        {{ location.name }} ({{ location.planet_galaxy }}.{{ location.planet_sector }}.{{ location.planet_planet }})
                                                                    </option>
                                                                {% endfor %}
                                                            </optgroup>
                                                        {% endif %}
                                                        {% if merchantplanetsgroup %}
                                                            <optgroup label="Planètes marchandes">
                                                                {% for location in merchantplanetsgroup %}
                                                                    <option {% if location.id == fleet.planetid %}selected{% endif %}>
                                                                        Marchand ({{ location.galaxy }}.{{ location.sector }}.{{ location.planet }})
                                                                    </option>
                                                                {% endfor %}
                                                            </optgroup>
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3 col-12">
                                    <div class="row gx-3 align-items-center justify-content-end">
                                        <div class="col-auto">
                                            <span class="text-normal me-2">Durée</span>
                                            <span id="travel_time">-</span>
                                        </div>
                                        <div class="col-auto">
                                            <span class="text-normal me-2">Coût</span>
                                            <img src="{{ PATH_IMAGES }}img/interface/credits.gif"
                                                 class="res"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-title="Crédits"
                                                 width="16px"
                                                 height="16px">
                                            <span id="travel_cost">0</span>
                                        </div>
                                        <div class="col-auto">
                                            <input type="submit" class="btn btn-primary" value="Envoyer">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <script>window.setTimeout("updatetravel()", 500);</script>
            {% endif %}
            {% if fleet.cargo_capacity > 0 %}
                <div class="mt-3" id="cargobox">
                    <script>
                function load_all(o,h,s,so,w) {
                
                    setval('load_ore',o);
                    setval('load_hydrocarbon',h);
                    setval('load_scientists',s);
                    setval('load_soldiers',so);
                    setval('load_workers',w);
                    return false;
                }

                function unload_all(o,h,s,so,w) {
                
                    setval('unload_ore',o);
                    setval('unload_hydrocarbon',h);
                    setval('unload_scientists',s);
                    setval('unload_soldiers',so);
                    setval('unload_workers',w);
                    return false;
                }
                {% if unload %}
                    showUnload({{ fleet.cargo_ore }},{{ fleet.cargo_hydrocarbon }},{{ fleet.cargo_scientists }},{{ fleet.cargo_soldiers }},{{ fleet.cargo_workers }},0
                    {% if canload %}1{% endif %}
                    );
                {% endif %}
                    </script>
                    {% if can_load_cargo %}
                        <form method="post" action="/s03/fleet-view/?id={{ fleet.id }}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="transfer">
                            <div class="card">
                                <div class="card-header">
                                    <span class="fs-6">Cargaison</span>
                                    <span class="ms-2 text-normal">Chargement et déchargement possible</span>
                                </div>
                                <div class="card-body">
                                    <div class="row g-1 flex-column">
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col-auto text-end" style="width:247px;">
                                                    <span class="text-normal">En soute</span>
                                                </div>
                                                <div class="col-auto text-end" style="width:253px;">
                                                    <span class="text-normal">Sur la planète</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/ore.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Minerai"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Minerai</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_ore|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_ore"
                                                           id="unload_ore"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#" class="ms-2" onclick="setval('unload_ore', {{ fleet.cargo_ore }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.ore|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_ore"
                                                           id="load_ore"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#" class="ms-2" onclick="setval('load_ore', {{ planet.ore }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/hydrocarbon.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Hydrocarbure"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Hydrocarbure</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_hydrocarbon|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_hydrocarbon"
                                                           id="unload_hydrocarbon"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_hydrocarbon', {{ fleet.cargo_hydrocarbon }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.hydrocarbon|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_hydrocarbon"
                                                           id="load_hydrocarbon"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_hydrocarbon', {{ planet.hydrocarbon }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/scientists.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Scientifiques"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Scientifiques</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_scientists|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_scientists"
                                                           id="unload_scientists"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_scientists', {{ fleet.cargo_scientists }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.scientists|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_scientists"
                                                           id="load_scientists"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_scientists', {{ planet.scientists }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/soldiers.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Soldats"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Soldats</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_soldiers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_soldiers"
                                                           id="unload_soldiers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_soldiers', {{ fleet.cargo_soldiers }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.soldiers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_soldiers"
                                                           id="load_soldiers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_soldiers', {{ planet.soldiers }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/workers.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Travailleurs"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Travailleurs</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_workers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_workers"
                                                           id="unload_workers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_workers', {{ fleet.cargo_workers }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.workers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_workers"
                                                           id="load_workers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_workers', {{ planet.workers }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-3">
                                            <div class="row gx-3 align-items-center justify-content-end">
                                                <div class="col-auto">
                                                    <a href="#"
                                                       onclick="return unload_all({{ fleet.cargo_ore }}, {{ fleet.cargo_hydrocarbon }}, {{ fleet.cargo_scientists }}, {{ fleet.cargo_soldiers }}, {{ fleet.cargo_workers }})">Tout décharger</a>
                                                </div>
                                                <div class="col-auto">
                                                    <a href="#"
                                                       onclick="return load_all({{ planet.ore }}, {{ planet.hydrocarbon }}, {{ planet.scientists }}, {{ planet.soldiers }}, {{ planet.workers }})">Tout charger</a>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="submit" class="btn btn-primary" value="Transférer">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    {% elif can_unload_cargo %}
                        <form method="post" action="/s03/fleet-view/?id={{ fleet.id }}">
                            <input type="hidden" name="action" value="transfer">
                            {% csrf_token %}
                            <div class="card">
                                <div class="card-header">
                                    <span class="fs-6">Cargaison</span>
                                    <span class="ms-2 text-normal">Déchargement uniquement possible</span>
                                </div>
                                <div class="card-body">
                                    <div class="row g-1 flex-column">
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col-auto text-end" style="width:247px;">
                                                    <span class="text-normal">En soute</span>
                                                </div>
                                                <div class="col-auto text-end" style="width:253px;">
                                                    <span class="text-normal">Sur la planète</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/ore.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Minerai"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Minerai</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_ore|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_ore"
                                                           id="unload_ore"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#" class="ms-2" onclick="setval('unload_ore', {{ fleet.cargo_ore }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.ore|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_ore"
                                                           id="load_ore"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#" class="ms-2" onclick="setval('load_ore', {{ planet.ore }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/hydrocarbon.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Hydrocarbure"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Hydrocarbure</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_hydrocarbon|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_hydrocarbon"
                                                           id="unload_hydrocarbon"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_hydrocarbon', {{ fleet.cargo_hydrocarbon }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.hydrocarbon|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_hydrocarbon"
                                                           id="load_hydrocarbon"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_hydrocarbon', {{ planet.hydrocarbon }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/scientists.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Scientifiques"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Scientifiques</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_scientists|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_scientists"
                                                           id="unload_scientists"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_scientists', {{ fleet.cargo_scientists }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.scientists|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_scientists"
                                                           id="load_scientists"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_scientists', {{ planet.scientists }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/soldiers.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Soldats"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Soldats</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_soldiers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_soldiers"
                                                           id="unload_soldiers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_soldiers', {{ fleet.cargo_soldiers }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.soldiers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_soldiers"
                                                           id="load_soldiers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_soldiers', {{ planet.soldiers }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row gx-3 align-items-center">
                                                <div class="col">
                                                    <img src="{{ PATH_IMAGES }}img/interface/workers.gif"
                                                         data-bs-toggle="tooltip"
                                                         data-bs-title="Travailleurs"
                                                         class="res"
                                                         width="16px"
                                                         height="16px"/>
                                                    <span class="text-normal">Travailleurs</span>
                                                </div>
                                                <div class="col-2 text-end">
                                                    {{ fleet.cargo_workers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="unload_workers"
                                                           id="unload_workers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('unload_workers', {{ fleet.cargo_workers }})">max</a>
                                                </div>
                                                <div class="col-3 text-end">
                                                    {{ planet.workers|intcomma }}
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <input type="number"
                                                           class="form-control"
                                                           min="0"
                                                           name="load_workers"
                                                           id="load_workers"
                                                           value="0"
                                                           size="6"/>
                                                    <a href="#"
                                                       class="ms-2"
                                                       onclick="setval('load_workers', {{ planet.workers }})">max</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-3">
                                            <div class="row gx-3 align-items-center justify-content-end">
                                                <div class="col-auto">
                                                    <a href="#"
                                                       onclick="return unload_all({{ fleet.cargo_ore }}, {{ fleet.cargo_hydrocarbon }}, {{ fleet.cargo_scientists }}, {{ fleet.cargo_soldiers }}, {{ fleet.cargo_workers }})">Tout décharger</a>
                                                </div>
                                                <div class="col-auto">
                                                    <a href="#"
                                                       onclick="return load_all({{ planet.ore }}, {{ planet.hydrocarbon }}, {{ planet.scientists }}, {{ planet.soldiers }}, {{ planet.workers }})">Tout charger</a>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="submit" class="btn btn-primary" value="Transférer">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    {% else %}
                        <div class="card">
                            <div class="card-header">
                                <span class="fs-6">Cargaison</span>
                                <span class="ms-2 text-normal">Aucune action possible</span>
                            </div>
                            <div class="card-body">
                                <div class="row gx-3 gy-1 align-items-center justify-content-center">
                                    {% if fleet.cargo_load <= 0 %}
                                        <div class="col-auto">
                                            <span class="text-normal">Vide</span>
                                        </div>
                                    {% else %}
                                        {% if fleet.cargo_ore > 0 %}
                                            <div class="col-auto">
                                                <img src="{{ PATH_IMAGES }}img/interface/ore.gif"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-title="Minerai"
                                                     class="res"
                                                     width="16px"
                                                     height="16px"/>
                                                {{ fleet.cargo_ore|intcomma }}
                                            </div>
                                        {% endif %}
                                        {% if fleet.cargo_hydrocarbon > 0 %}
                                            <div class="col-auto">
                                                <img src="{{ PATH_IMAGES }}img/interface/hydrocarbon.gif"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-title="Hydrocarbure"
                                                     class="res"
                                                     width="16px"
                                                     height="16px"/>
                                                {{ fleet.cargo_hydrocarbon|intcomma }}
                                            </div>
                                        {% endif %}
                                        {% if fleet.cargo_scientists > 0 %}
                                            <div class="col-auto">
                                                <img src="{{ PATH_IMAGES }}img/interface/scientists.gif"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-title="Scientifiques"
                                                     class="res"
                                                     width="16px"
                                                     height="16px"/>
                                                {{ fleet.cargo_scientists|intcomma }}
                                            </div>
                                        {% endif %}
                                        {% if fleet.cargo_soldiers > 0 %}
                                            <div class="col-auto">
                                                <img src="{{ PATH_IMAGES }}img/interface/soldiers.gif"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-title="Soldats"
                                                     class="res"
                                                     width="16px"
                                                     height="16px"/>
                                                {{ fleet.cargo_soldiers|intcomma }}
                                            </div>
                                        {% endif %}
                                        {% if fleet.cargo_workers > 0 %}
                                            <div class="col-auto">
                                                <img src="{{ PATH_IMAGES }}img/interface/workers.gif"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-title="Travailleurs"
                                                     class="res"
                                                     width="16px"
                                                     height="16px"/>
                                                {{ fleet.cargo_workers|intcomma }}
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
        <div class="col-4">
            <div class="card">
                <div class="card-header">
                    <div class="row gx-3">
                        <div class="col">
                            <span class="fs-6">Vaisseaux</span>
                        </div>
                        {% if can_manage %}
                            <div class="col-auto">
                                <a href="/s03/fleet-ships/?id={{ fleet.id }}">Gérer</a>
                            </div>
                        {% endif %}
                        {% if can_split %}
                            <div class="col-auto">
                                <a href="/s03/fleet-split/?id={{ fleet.id }}">Scinder</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                <div class="row gy-2 flex-column">
                    {% for ship in ships %}
                        <div class="col-12">
                            <div class="row gx-3">
                                <div class="col-auto pe-0">
                                    <span class="text-normal"><i class="fa-fw fas fa-question-circle" data-bs-toggle="tooltip" data-bs-html="true" data-bs-title="
                                        <div class='mb-1'><span class='fs-6'>Description</span></div>
                                        <div class='mb-3'><span class='text-normal'>{{ ship.description|escape }}</span></div>
                                        <div class='mb-1'><span class='fs-6'>Caractéristiques</span></div>
                                        <div class='row gx-3 gy-1'>
                                            <div class='col-auto'>
                                                <small class='text-normal'>Signature</small>
                                                <span class='text-white'>{{ ship.signature|intcomma }}</span>
                                            </div>
                                            {% if ship.capacity > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Cargo</small>
                                                    <span class='text-white'>{{ ship.capacity|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                            <div class='col-auto'>
                                                <small class='text-normal'>Vitesse</small>
                                                <span class='text-white'>{{ ship.speed|intcomma }}</span>
                                            </div>
                                            <div class='col-auto'>
                                                <small class='text-normal'>Manœuvrabilité</small>
                                                <span class='text-white'>{{ ship.handling|intcomma }}</span>
                                            </div>
                                            <div class='col-auto'>
                                                <small class='text-normal'>Armure</small>
                                                <span class='text-white'>{{ ship.hull|intcomma }}</span>
                                            </div>
                                            {% if ship.weapon_turrets > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Dommage</small>
                                                    <span class='text-white'>{{ ship.weapon_turrets|intcomma }} <small class='text-normal'>x</small> {{ ship.weapon_power|intcomma }}</span>
                                                </div>
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Ciblage</small>
                                                    <span class='text-white'>{{ ship.weapon_tracking_speed|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                            {% if ship.shield > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Bouclier</small>
                                                    <span class='text-white'>{{ ship.shield|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                            {% if ship.recycler_output > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Recyclage</small>
                                                    <span class='text-white'>{{ ship.recycler_output|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                            {% if ship.ship_long_distance_capacity > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Saut</small>
                                                    <span class='text-white'>{{ ship.ship_long_distance_capacity|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                            {% if ship.droppods > 0 %}
                                                <div class='col-auto'>
                                                    <small class='text-normal'>Invasion</small>
                                                    <span class='text-white'>{{ ship.droppods|intcomma }}</span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    "></i></span>
                                </div>
                                <div class="col">
                                    <a href="/s03/help/?cat=ships#{{ ship.id }}"
                                       data-bs-toggle="tooltip"
                                       data-bs-title="Voir aide">{{ ship.label }}</a>
                                    <small class="mx-1 text-normal">x</small>
                                    {{ ship.quantity|intcomma }}
                                </div>
                                {% if can_install_building and ship.buildingid and ship.can_build %}
                                    <div class="col-auto">
                                        <a href="?id={{ fleet.id }}&action=install&s={{ ship.id }}">Déployer</a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                </div>
            </div>
            {% if fleets|length > 0 %}
                <div class="mt-3 card">
                    <div class="card-header">
                        <span class="fs-6">Autres flottes</span>
                    </div>
                    <div class="card-body">
                    <div class="row gy-2 flex-column">
                        {% for orbittingfleet in fleets %}
                            <div class="col-12">
                                <div class="row gx-3">
                                    {% if orbittingfleet.relation == 2 %}
                                        <div class="col-auto pe-0">
                                            <span class="text-normal"><i class="fa-fw fas fa-question-circle" data-bs-toggle="tooltip" data-bs-html="true" data-bs-title="
                                                <div class='row g-1 flex-column'>
                                                    <div class='col-12'>
                                                        <div class='row gx-3'>
                                                            <div class='col'>
                                                                <span class='text-normal'>Signature</span>
                                                            </div>
                                                            <div class='col-auto'>
                                                                <span>{{ orbittingfleet.signature|intcomma }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class='col-12'>
                                                        <div class='row gx-3'>
                                                            <div class='col'>
                                                                <span class='text-normal'>Vitesse</span>
                                                            </div>
                                                            <div class='col-auto'>
                                                                <span>{{ orbittingfleet.speed|intcomma }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class='col-12'>
                                                        <div class='row gx-3'>
                                                            <div class='col'>
                                                                <span class='text-normal'>Cargo</span>
                                                            </div>
                                                            <div class='col-auto'>
                                                                <span>{{ orbittingfleet.cargo_load|intcomma }}</span> <small class='text-normal'>/{{ orbittingfleet.cargo_capacity|intcomma }}</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            "></i></span>
                                        </div>
                                        <div class="col">
                                            <a href="?id={{ orbittingfleet.id }}" class="text-info" data-bs-toggle="tooltip" data-bs-html="true" data-bs-title="Voir flotte">{{ orbittingfleet.name }}</a>
                                            <small class="ms-2">{{ orbittingfleet.signature|intcomma }}</small>
                                        </div>
                                        {% if orbittingfleet.action == 0 and fleet.action == 0 %}
                                            <div class="col-auto">
                                                <a href="?id={{ fleet.id }}&action=merge&with={{ orbittingfleet.id }}">Absorber</a>
                                            </div>
                                        {% endif %}
                                    {% else %}
                                        <div class="col">
                                            <a href="/s03/mail-new/?subject=À propos de la flotte {{ orbittingfleet.name }}&to={{ orbittingfleet.owner }}"
                                               data-bs-toggle="tooltip"
                                               data-bs-title="Contacter {{ orbittingfleet.owner }}"
                                               class="{% if orbittingfleet.relation == 1 %}text-success{% elif orbittingfleet.relation == 0 %}text-friend{% else %}text-danger{% endif %}">
                                                {% if orbittingfleet.alliance %}[{{ orbittingfleet.tag }}]{% endif %}
                                                {{ orbittingfleet.name }}
                                            </a>
                                            <small class="ms-2">{{ orbittingfleet.signature|intcomma }}</small>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% if context %}</div>{% endif %}
{% endblock %}
