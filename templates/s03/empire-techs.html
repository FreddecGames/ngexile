{% extends 's03/layout.html' %}

{% load humanize %}

{% block content %}
<script>
    function cancelresearch() { return confirm('Êtes-vous sûr de vouloir abandonner cette recherche ?\r\nNote: toute recherche future recommencera à zéro') }

    function putlevel(level,levels,inprogress) {
    
        var s;
        if (levels <= 5) {
        
            if (!inprogress) s = '<img src="{{PATH_IMAGES}}research/level' + levels + '_' + level + '.gif" alt="Niveau ' + level + '">';
            else s = '<img src="{{PATH_IMAGES}}research/leveling' + levels + '_' + level + '.gif" alt="Niveau ' + (level + 1) + ' en cours">';
        }
        else {
        
            if (!inprogress) s = level + '/' + levels;
            else s = 'Niveau ' + (level+1) + ' en cours';
        }
        
        document.write(s);
    }
</script>

<div class="row g-3">
    {% for category in categories %}
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    {% if category.id == 10 %}Technologies{% endif %}
                    {% if category.id == 20 %}Industrie{% endif %}
                    {% if category.id == 30 %}Empire{% endif %}
                    {% if category.id == 40 %}Recherche{% endif %}
                    {% if category.id == 50 %}Technologies militaires{% endif %}
                    {% if category.id == 90 %}Vaisseaux spatiaux{% endif %}
                </div>
                <div class="list-group list-group-flush">
                    {% for research in category.researches %}
                        <div class="list-group-item {% if research.remainingtime %}bg-success{% endif %}">
                            <div class="row gx-3 align-items-center">
                                <div class="col">
                                    <a href="/s03/help/?cat=research#{{research.id}}" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true" data-bs-title="
                                        <div class='row g-1'>
                                            <div class='col-12 text-start fs-6'>{{research.name}}</div>
                                            <div class='col-12 text-start text-normal '>{{research.description}}</div>
                                        </div>
                                    ">{{research.name}}</a>
                                </div>
                                <div class="col-auto text-end" style="width:85px;">
                                    <script>putlevel({{research.level}}, {{research.levels}} ,0{% if research.leveling %}1{% endif %});</script>
                                </div>
                                <div class="col-auto text-end" style="width:85px;">
                                    {% if research.credits %}<img src="{{PATH_IMAGES}}interface/credits.gif" width="16px" class="res" />{{research.credits|intcomma}}
                                    {% else %}-
                                    {% endif %}
                                </div>
                                <div class="col-2 text-end">
                                    {% if research.remainingtime %}<span class="text-yellow"><script>putcountdown1({{research.remainingtime}}, "");</script></span>
                                    {% elif research.time %}<script>document.write(formattime({{research.time}}));</script>
                                    {% else %}-
                                    {% endif %}
                                </div>
                                <div class="col-3 text-center">
                                    {% if research.complete %}-
                                    {% elif research.busy %}-
                                    {% elif research.notresearchable %}<span class="text-danger">Recherche impossible</span>
                                    {% elif research.notenoughmoney %}<span class="text-danger">Fonds insuffisants</span>
                                    {% elif research.research %}<a href="?a=research&r={{research.id}}">Rechercher</a>
                                    {% elif research.researching %}<script>putcountdown2({{research.remainingtime}}, "<a href='?a=cancel&r={{research.id}}' title='Annuler' onclick='return cancelresearch()'>Annuler</a>", "<a href='/s03/empire-techs/'>Terminée</a>");</script>
                                    {% endif %}
                                    {% if research.auto %}- <a href='/s03/empire-techs/?a=stop&r={{research.id}}'>Automatique</a>
                                    {% elif research.manual %}- <a href='/s03/empire-techs/?a=continue&r={{research.id}}'>Manuel</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% endblock %}